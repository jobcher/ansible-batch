# Ansible æœåŠ¡å™¨èµ„äº§æ‰«æå·¥å…·

è¿™æ˜¯ä¸€ä¸ªåŸºäºAnsibleçš„æœåŠ¡å™¨èµ„äº§æ‰«æå’Œå‘ç°å·¥å…·ï¼Œå¯ä»¥æ‰¹é‡æ‰«æç½‘ç»œä¸­çš„æœåŠ¡å™¨å¹¶è·å–è¯¦ç»†çš„èµ„äº§çŠ¶æ€ä¿¡æ¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **ç½‘ç»œå‘ç°**: è‡ªåŠ¨æ‰«æç½‘ç»œä¸­çš„æ´»è·ƒä¸»æœº
- ğŸ“Š **èµ„äº§æ”¶é›†**: æ”¶é›†æœåŠ¡å™¨çš„ç¡¬ä»¶ã€è½¯ä»¶ã€ç½‘ç»œç­‰è¯¦ç»†ä¿¡æ¯
- ğŸ“ˆ **çŠ¶æ€ç›‘æ§**: ç›‘æ§æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
- ğŸ“‹ **æŠ¥å‘Šç”Ÿæˆ**: ç”Ÿæˆå¤šç§æ ¼å¼çš„èµ„äº§æŠ¥å‘Šï¼ˆJSONã€HTMLã€CSVã€TXTï¼‰
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰æ‰«æèŒƒå›´å’Œå‚æ•°

## é¡¹ç›®ç»“æ„

```
ansible-batch/
â”œâ”€â”€ inventory/
â”‚   â””â”€â”€ hosts.yml              # ä¸»æœºæ¸…å•æ–‡ä»¶
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ asset_discovery/       # èµ„äº§å‘ç°è§’è‰²
â”‚   â”œâ”€â”€ network_scanner/       # ç½‘ç»œæ‰«æè§’è‰²
â”‚   â””â”€â”€ report_generator/      # æŠ¥å‘Šç”Ÿæˆè§’è‰²
â”œâ”€â”€ site.yml                   # ä¸»playbook
â”œâ”€â”€ ansible.cfg               # Ansibleé…ç½®æ–‡ä»¶
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- Ansible 2.9+
- Python 3.6+
- nmap (ç”¨äºç½‘ç»œæ‰«æ)

### 2. é…ç½®ä¸»æœºæ¸…å•

ç¼–è¾‘ `inventory/hosts.yml` æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨è¦æ‰«æçš„æœåŠ¡å™¨ï¼š

```yaml
all:
  children:
    servers:
      hosts:
        server1:
          ansible_host: 192.168.1.10
          ansible_user: admin
          ansible_ssh_private_key_file: ~/.ssh/id_rsa
        server2:
          ansible_host: 192.168.1.11
          ansible_user: admin
          ansible_ssh_private_key_file: ~/.ssh/id_rsa
```

### 3. é…ç½®SSHå¯†é’¥

ç¡®ä¿æ‚¨æœ‰è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„SSHå¯†é’¥ï¼š

```bash
# ç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t rsa -b 4096

# å°†å…¬é’¥å¤åˆ¶åˆ°ç›®æ ‡æœåŠ¡å™¨
ssh-copy-id admin@192.168.1.10
```

### 4. è¿è¡Œæ‰«æ

```bash
# è¿è¡Œå®Œæ•´çš„èµ„äº§æ‰«æ
ansible-playbook site.yml

# åªè¿è¡Œèµ„äº§å‘ç°
ansible-playbook site.yml --tags asset,discovery

# åªè¿è¡Œç½‘ç»œæ‰«æ
ansible-playbook site.yml --tags network,scanner

# åªç”ŸæˆæŠ¥å‘Š
ansible-playbook site.yml --tags report,generator
```

## é…ç½®é€‰é¡¹

### ç½‘ç»œæ‰«æé…ç½®

åœ¨ `roles/network_scanner/defaults/main.yml` ä¸­é…ç½®ï¼š

```yaml
network_scanner:
  network_subnet: "192.168.1.0/24"  # æ‰«æç½‘æ®µ
  scan_ports: [22, 80, 443, 3306]   # æ‰«æç«¯å£
  scan_timeout: 300                  # æ‰«æè¶…æ—¶æ—¶é—´
```

### èµ„äº§æ”¶é›†é…ç½®

åœ¨ `roles/asset_discovery/defaults/main.yml` ä¸­é…ç½®ï¼š

```yaml
asset_discovery:
  detailed_info: true      # æ”¶é›†è¯¦ç»†ä¿¡æ¯
  collect_network: true    # æ”¶é›†ç½‘ç»œä¿¡æ¯
  collect_services: true   # æ”¶é›†æœåŠ¡ä¿¡æ¯
  collect_security: true   # æ”¶é›†å®‰å…¨ä¿¡æ¯
```

### æŠ¥å‘Šé…ç½®

åœ¨ `roles/report_generator/defaults/main.yml` ä¸­é…ç½®ï¼š

```yaml
report_generator:
  report_path: "/tmp/asset_reports"  # æŠ¥å‘Šä¿å­˜è·¯å¾„
  formats: [json, html, csv, txt]    # æŠ¥å‘Šæ ¼å¼
  include_details: true              # åŒ…å«è¯¦ç»†ä¿¡æ¯
```

## æ”¶é›†çš„ä¿¡æ¯

### ç³»ç»Ÿä¿¡æ¯
- æ“ä½œç³»ç»Ÿç±»å‹å’Œç‰ˆæœ¬
- å†…æ ¸ç‰ˆæœ¬
- ç³»ç»Ÿæ¶æ„
- ä¸»æœºåå’ŒåŸŸå

### ç¡¬ä»¶ä¿¡æ¯
- CPUå‹å·å’Œæ ¸å¿ƒæ•°
- å†…å­˜å®¹é‡å’Œä½¿ç”¨æƒ…å†µ
- ç£ç›˜ç©ºé—´å’Œåˆ†åŒºä¿¡æ¯
- ç½‘ç»œæ¥å£ä¿¡æ¯

### ç½‘ç»œä¿¡æ¯
- IPåœ°å€é…ç½®
- ç½‘ç»œæ¥å£çŠ¶æ€
- è·¯ç”±è¡¨ä¿¡æ¯
- å¼€æ”¾ç«¯å£åˆ—è¡¨

### ç³»ç»ŸçŠ¶æ€
- ç³»ç»Ÿè¿è¡Œæ—¶é—´
- è´Ÿè½½å¹³å‡å€¼
- è¿è¡Œçš„æœåŠ¡
- ç”¨æˆ·ç™»å½•ä¿¡æ¯

## æŠ¥å‘Šæ ¼å¼

### JSONæ ¼å¼
ç»“æ„åŒ–çš„JSONæ•°æ®ï¼Œä¾¿äºç¨‹åºå¤„ç†å’Œåˆ†æã€‚

### HTMLæ ¼å¼
ç¾è§‚çš„ç½‘é¡µæŠ¥å‘Šï¼ŒåŒ…å«å›¾è¡¨å’Œè¯¦ç»†ä¿¡æ¯ã€‚

### CSVæ ¼å¼
è¡¨æ ¼æ ¼å¼ï¼Œä¾¿äºåœ¨Excelç­‰å·¥å…·ä¸­åˆ†æã€‚

### TXTæ ¼å¼
çº¯æ–‡æœ¬æ ¼å¼ï¼Œä¾¿äºæŸ¥çœ‹å’Œæ‰“å°ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### æ‰«æç‰¹å®šç½‘æ®µ

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export NETWORK_SUBNET="10.0.0.0/24"

# è¿è¡Œæ‰«æ
ansible-playbook site.yml -e "network_subnet=$NETWORK_SUBNET"
```

### ç”Ÿæˆç‰¹å®šæ ¼å¼æŠ¥å‘Š

```bash
# åªç”ŸæˆHTMLæŠ¥å‘Š
ansible-playbook site.yml --tags report,generator -e "report_formats=['html']"
```

### å¹¶è¡Œæ‰«æ

```bash
# å¢åŠ å¹¶è¡Œåº¦
ansible-playbook site.yml -f 20
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **SSHè¿æ¥å¤±è´¥**
   - æ£€æŸ¥SSHå¯†é’¥é…ç½®
   - ç¡®è®¤ç›®æ ‡æœåŠ¡å™¨SSHæœåŠ¡è¿è¡Œæ­£å¸¸
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

2. **æƒé™é—®é¢˜**
   - ç¡®ä¿ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œå‘½ä»¤
   - æ£€æŸ¥sudoé…ç½®

3. **ç½‘ç»œæ‰«æå¤±è´¥**
   - ç¡®è®¤nmapå·²å®‰è£…
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤æœ‰æ‰«ææƒé™

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
ansible-playbook site.yml -vvv

# æµ‹è¯•è¿æ¥
ansible all -m ping

# æ£€æŸ¥ä¸»æœºæ¸…å•
ansible-inventory --list
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

- ç¡®ä¿åªåœ¨æˆæƒçš„ç½‘ç»œä¸­è¿›è¡Œæ‰«æ
- éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œå…¬å¸æ”¿ç­–
- ä¿æŠ¤æ”¶é›†çš„æ•æ„Ÿä¿¡æ¯
- å®šæœŸæ›´æ–°SSHå¯†é’¥å’Œå¯†ç 

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## è®¸å¯è¯

MIT License 