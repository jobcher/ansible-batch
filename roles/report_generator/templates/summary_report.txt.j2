==========================================
           服务器资产扫描汇总报告
==========================================

生成时间: {{ ansible_date_time.iso8601 }}
扫描主机总数: {{ groups['servers'] | length }}

==========================================
系统分布统计
==========================================
{% set os_stats = {} %}
{% for host in groups['servers'] %}
{% set host_vars = hostvars[host] %}
{% set os_name = host_vars.ansible_distribution | default('Unknown') %}
{% if os_name not in os_stats %}
{% set _ = os_stats.update({os_name: 0}) %}
{% endif %}
{% set _ = os_stats.update({os_name: os_stats[os_name] + 1}) %}
{% endfor %}
{% for os_name, count in os_stats.items() %}
{{ os_name }}: {{ count }} 台
{% endfor %}

==========================================
硬件配置统计
==========================================
{% set total_cpu = 0 %}
{% set total_memory = 0 %}
{% for host in groups['servers'] %}
{% set host_vars = hostvars[host] %}
{% set total_cpu = total_cpu + (host_vars.ansible_processor_cores | default(0) | int) %}
{% set total_memory = total_memory + (host_vars.ansible_memtotal_mb | default(0) | int) %}
{% endfor %}
总CPU核心数: {{ total_cpu }}
总内存容量: {{ total_memory }} MB ({{ (total_memory / 1024) | round(2) }} GB)

==========================================
网络信息统计
==========================================
{% set unique_ips = [] %}
{% for host in groups['servers'] %}
{% set host_vars = hostvars[host] %}
{% set ip = host_vars.ansible_host | default('unknown') %}
{% if ip not in unique_ips and ip != 'unknown' %}
{% set _ = unique_ips.append(ip) %}
{% endif %}
{% endfor %}
扫描IP地址数: {{ unique_ips | length }}

==========================================
详细主机列表
==========================================
{% for host in groups['servers'] %}
{% set host_vars = hostvars[host] %}
主机名: {{ host }}
IP地址: {{ host_vars.ansible_host | default('unknown') }}
操作系统: {{ host_vars.ansible_distribution | default('unknown') }} {{ host_vars.ansible_distribution_version | default('') }}
内核版本: {{ host_vars.ansible_kernel | default('unknown') }}
CPU核心数: {{ host_vars.ansible_processor_cores | default('unknown') }}
内存容量: {{ host_vars.ansible_memtotal_mb | default('unknown') }} MB
默认IP: {{ host_vars.ansible_default_ipv4.address | default('unknown') }}
网络接口数: {{ host_vars.ansible_interfaces | default([]) | length }}
运行时间: {{ host_vars.load_info.stdout | default('unknown') }}
状态: 在线
------------------------------------------
{% endfor %}

==========================================
扫描完成
==========================================
报告生成完成时间: {{ ansible_date_time.iso8601 }} 