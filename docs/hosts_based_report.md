# 基于hosts.yml的报告生成功能

## 功能说明

此功能允许跳过网络扫描，直接基于 `inventory/hosts.yml` 中配置的主机信息生成资产报告。

## 主要变更

### 1. 跳过网络扫描

在 `site_python27.yml` 中：
- 设置 `scan_network: false` 跳过网络扫描
- 移除了网络扫描相关的 playbook
- 直接基于 hosts.yml 中的主机进行报告生成

### 2. 报告生成器更新

更新了 `roles/report_generator/tasks/main.yml`：
- 收集 hosts.yml 中的主机信息而不是网络扫描结果
- 添加了主机信息显示任务

### 3. 报告模板更新

更新了所有报告模板以支持基于 hosts.yml 的数据：

#### JSON 报告 (`asset_report.json.j2`)
- 添加了连接信息（用户名、Python解释器等）
- 支持未收集到系统信息的情况
- 添加了报告类型标识

#### CSV 报告 (`asset_report.csv.j2`)
- 添加了用户名和Python解释器列
- 改进了数据处理的健壮性

#### 汇总报告 (`summary_report.txt.j2`)
- 添加了连接信息统计
- 更新了状态显示为"配置中"
- 改进了数据处理的健壮性

## 使用方法

### 1. 运行完整流程（跳过网络扫描）

```bash
ansible-playbook site_python27.yml
```

### 2. 仅生成报告

```bash
ansible-playbook site_python27.yml --tags report
```

### 3. 运行测试脚本

```bash
./scripts/test_hosts_based_report.sh
```

## 报告内容

生成的报告包含以下信息：

### 基本信息
- 主机名
- IP地址
- 用户名
- Python解释器路径

### 系统信息（如果已收集）
- 操作系统名称和版本
- 内核版本
- 系统架构

### 硬件信息（如果已收集）
- CPU核心数
- 内存容量
- 磁盘信息

### 网络信息（如果已收集）
- 网络接口
- 默认IP地址

### 系统状态（如果已收集）
- 运行时间
- 负载情况

## 优势

1. **快速生成**: 不需要等待网络扫描完成
2. **配置驱动**: 基于预定义的主机配置
3. **灵活性强**: 可以混合使用配置信息和扫描信息
4. **错误处理**: 对未收集到的信息有良好的容错处理

## 注意事项

- 如果主机信息未通过资产发现收集，相关字段将显示为"unknown"
- 报告状态显示为"配置中"而不是"在线"，因为未进行实际的连接测试
- 确保 hosts.yml 中的主机配置正确且完整 